#!/usr/bin/env zsh
# Thin loader - sources shared modules then platform-specific config
# Kiro CLI pre block. Keep at the top of this file.
[[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.pre.zsh" ]] && builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.pre.zsh"

DOTFILES_DIR="${DOTFILES_DIR:-$HOME/dotfiles}"

# Shared modules (alphabetical order, local.zsh excluded)
for f in "$DOTFILES_DIR"/shell/zsh/*.zsh(N); do
  [[ "$(basename $f)" == "local.zsh" ]] && continue
  source "$f"
done

# fzf setup (platform-specific paths, shared functions already loaded above)
[[ -f "$DOTFILES_DIR/shell/fzf.zsh" ]] && source "$DOTFILES_DIR/shell/fzf.zsh"

# Platform-specific settings
[[ -f "$DOTFILES_DIR/platform/$DOTFILES_PLATFORM/zshrc.zsh" ]] && \
  source "$DOTFILES_DIR/platform/$DOTFILES_PLATFORM/zshrc.zsh"

# Machine-specific local config (gitignored)
[[ -f "$DOTFILES_DIR/shell/zsh/local.zsh" ]] && \
  source "$DOTFILES_DIR/shell/zsh/local.zsh"

# Kiro CLI post block. Keep at the bottom of this file.
[[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh" ]] && builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh"
